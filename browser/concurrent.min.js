!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.concurrent=b()}(this,function(){var a="function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},b={isArray:function(a){return Array.isArray(a)},inherits:function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}},c={PENDING:"pending",FULFILLED:"fulfilled",REJECTED:"rejected"},d=function(b){var c;c=function(){var d=b.callbacks.shift();d&&d[b.state]&&d[b.state](b.value),b.callbacks.length>0&&a(c)},a(c)},e=function(a,b,e){return a.state===c.FULFILLED||a.state===c.REJECTED?a.state:(a.state=b,a.value=e,d(a),a.state)},f=function(a,b,c){return function(d){if("function"!=typeof c)return e(a,b,d);try{var f=c(d);return f&&"function"==typeof f.then?(f.then(function(b){a.fulfill(b)},function(b){a.reject(b)}),a.state):a.fulfill(f)}catch(g){return a.reject(g)}}},g=function(){this.state=c.PENDING,this.callbacks=[]};g.prototype.then=function(a,b){var e=new this.constructor,g={};return g[c.FULFILLED]=f(e,c.FULFILLED,a),g[c.REJECTED]=f(e,c.REJECTED,b),this.callbacks.push(g),this.state!==c.PENDING&&d(this),e},g.prototype.fulfill=function(a){e(this,c.FULFILLED,a)},g.prototype.reject=function(a){e(this,c.REJECTED,a)};var h=function(){g.call(this)};b.inherits(h,g),h.prototype.isCompleted=function(){return this.state!==c.PENDING},h.prototype.onComplete=function(a){this.then(function(b){a(b)},function(b){a(b)})},h.prototype.convert=function(a){var c=this;return function(){var d=Array.prototype.slice.call(arguments),e=d.shift();return e?c.reject(e):(1===d.length&&(d=d.shift()),b.isArray(a)&&(d=a.reduce(function(a,b,c){return a[b]=d[c],a},{})),c.fulfill(d))}},h.prototype.ready=function(a){var b=new this.constructor;return this.then(function(a){b.fulfill(a)}),setTimeout(function(){b.reject(new Error("Did not resolve future in "+a+" ms"))},a),b},h.prototype.fallbackTo=function(a){var b=new this.constructor;return this.then(function(a){b.fulfill(a)},function(){a.then(function(a){b.fulfill(a)})}),b},h.prototype.filter=function(a){var b=new this.constructor;return this.then(function(c){return a(c)?b.fulfill(c):b.reject(new Error("Value does not match predicate"))},function(a){b.reject(a)}),b},h.prototype.map=function(a){return this.then(a)},h.prototype.onFailure=function(a){this.then(null,a)},h.prototype.onSuccess=function(a){this.then(a)},h.prototype.recover=function(a){var b=new this.constructor;return this.then(function(a){b.fulfill(a)},function(){b.fulfill(a)}),b},h.prototype.transform=h.prototype.then,h.prototype.zip=function(a){var b=new this.constructor;return this.then(function(c){a.then(function(a){b.fulfill([c,a])})}),b},h.sequence=function(a){var c,d,e=new h,f=0,g=function(a,b){a.then(function(a){c[b]=a,++f>=d&&e.fulfill(c)},function(a){e.reject(a)})};if(b.isArray(a))c=[],d=a.length,a.forEach(g);else{c={},d=Object.keys(a).length;for(var i in a)g(a[i],i)}return e};var i={},j=i.forEach=function(b,c){var d=new h,e=0;return b.forEach(function(b,f,g){a(function(){try{c(b,f,g)}catch(a){d.reject(a)}++e>=g.length&&d.fulfill(e)})}),d};i.every=function(a,b){var c=new h,d=j(a,function(a,d,e){b(a,d,e)||c.fulfill(!1)});return d.then(function(){c.fulfill(!0)},function(a){c.reject(a)}),c},i.some=function(a,b){var c=new h,d=j(a,function(a,d,e){b(a,d,e)&&c.fulfill(!0)});return d.then(function(){c.fulfill(!1)},function(a){c.reject(a)}),c},i.filter=function(a,b){var c=new h,d=[],e=j(a,function(a,c,e){b(a,c,e)&&d.push(a)});return e.then(function(){c.fulfill(d)},function(a){c.reject(a)}),c},i.map=function(a,b){var c=new h,d=[],e=j(a,function(a,c,e){d.push(b(a,c,e))});return e.then(function(){c.fulfill(d)},function(a){c.reject(a)}),c};var k=i.reverse=function(a){var b=new h,c=[],d=j(a,function(a){c.unshift(a)});return d.then(function(){b.fulfill(c)},function(a){b.reject(a)}),b},l=i.reduce=function(a,b,c){var d,e,f=new h;c?(d=c,e=a):(d=a[0],e=a.slice(1));var g=j(a,function(a,c,e){d=b(d,a,c,e)});return g.then(function(){f.fulfill(d)},function(a){f.reject(a)}),f};return i.reduceRight=function(a,b,c){return k(a).then(function(a){return l(a,b,c)})},{State:c,Promise:g,Future:h,collections:i}});