!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.concurrent=b()}(this,function(){var a="function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},b={isArray:function(a){return Array.isArray(a)},inherits:function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}},c={PENDING:"pending",FULFILLED:"fulfilled",REJECTED:"rejected"},d=function(b){var c;c=function(){var d=b.callbacks.shift();d&&d[b.state]&&d[b.state](b.value),b.callbacks.length>0&&a(c)},a(c)},e=function(a,b,e){return a.state===c.FULFILLED||a.state===c.REJECTED?a.state:(a.state=b,a.value=e,d(a),a.state)},f=function(a,b,c){return function(d){if("function"!=typeof c)return e(a,b,d);try{var f=c(d);return f&&"function"==typeof f.then?(f.then(function(b){a.fulfill(b)},function(b){a.reject(b)}),a.state):a.fulfill(f)}catch(g){return a.reject(g)}}},g=function(){this.state=c.PENDING,this.callbacks=[]};g.prototype.then=function(a,b){var e=new this.constructor,g={};return g[c.FULFILLED]=f(e,c.FULFILLED,a),g[c.REJECTED]=f(e,c.REJECTED,b),this.callbacks.push(g),this.state!==c.PENDING&&d(this),e},g.prototype.fulfill=function(a){e(this,c.FULFILLED,a)},g.prototype.reject=function(a){e(this,c.REJECTED,a)};var h=function(a){Error.captureStackTrace(this,this),this.value=a,this.message=""+this.value+" did not match predicate"};b.inherits(h,Error),h.prototype.name="ValidationError";var i=function(a){Error.captureStackTrace(this,this),this.time=a,this.message="Future did not resolve in "+this.time+" ms"};b.inherits(i,Error),i.prototype.name="TimeoutError";var j=function(){g.call(this)};b.inherits(j,g),j.prototype.isCompleted=function(){return this.state!==c.PENDING},j.prototype.onComplete=function(a){this.then(function(b){a(b)},function(b){a(b)})},j.prototype.convert=function(a){var c=this;return function(){var d=Array.prototype.slice.call(arguments),e=d.shift();return e?c.reject(e):(1===d.length&&(d=d.shift()),b.isArray(a)&&(d=a.reduce(function(a,b,c){return a[b]=d[c],a},{})),c.fulfill(d))}},j.prototype.ready=function(a){var b=new this.constructor;return this.then(function(a){b.fulfill(a)}),setTimeout(function(){try{throw new i(a)}catch(c){b.reject(c)}},a),b},j.prototype.fallbackTo=function(a){return this.then(null,function(){return a})},j.prototype.filter=function(a){return this.then(function(b){if(!a(b))throw new h(b);return b})},j.prototype.map=function(a){return this.then(a)},j.prototype.onFailure=function(a){this.then(null,a)},j.prototype.onSuccess=function(a){this.then(a)},j.prototype.recover=function(a){var b=new this.constructor;return this.then(function(a){b.fulfill(a)},function(){b.fulfill(a)}),b},j.prototype.recoverWith=function(a){return this.then(null,a)},j.prototype.transform=j.prototype.then,j.prototype.zip=function(a){return this.then(function(b){return a.then(function(a){return[b,a]})})},j.fulfilled=function(a){var b=new j;return b.fulfill(a),b},j.rejected=function(a){var b=new j;return b.reject(a),b},j.sequence=function(a){var c,d,e=new j,f=0,g=function(a,b){a.then(function(a){c[b]=a,++f>=d&&e.fulfill(c)},function(a){e.reject(a)})};if(b.isArray(a))c=[],d=a.length,a.forEach(g);else{c={},d=Object.keys(a).length;for(var h in a)g(a[h],h)}return e},j.wrap=function(a){var b=new j;return a.then(function(a){b.fulfill(a)},function(a){b.reject(a)}),b};var k={},l=k.forEach=function(b,c){var d=new j,e=0;return b.forEach(function(b,f,g){a(function(){try{c(b,f,g)}catch(a){d.reject(a)}++e>=g.length&&d.fulfill(e)})}),d};k.every=function(a,b){var c=new j,d=l(a,function(a,d,e){b(a,d,e)||c.fulfill(!1)});return d.then(function(){c.fulfill(!0)},function(a){c.reject(a)}),c},k.some=function(a,b){var c=new j,d=l(a,function(a,d,e){b(a,d,e)&&c.fulfill(!0)});return d.then(function(){c.fulfill(!1)},function(a){c.reject(a)}),c},k.filter=function(a,b){var c=new j,d=[],e=l(a,function(a,c,e){b(a,c,e)&&d.push(a)});return e.then(function(){c.fulfill(d)},function(a){c.reject(a)}),c},k.map=function(a,b){var c=new j,d=[],e=l(a,function(a,c,e){d.push(b(a,c,e))});return e.then(function(){c.fulfill(d)},function(a){c.reject(a)}),c};var m=k.reverse=function(a){var b=new j,c=[],d=l(a,function(a){c.unshift(a)});return d.then(function(){b.fulfill(c)},function(a){b.reject(a)}),b},n=k.reduce=function(a,b,c){var d,e,f=new j;c?(d=c,e=a):(d=a[0],e=a.slice(1));var g=l(a,function(a,c,e){d=b(d,a,c,e)});return g.then(function(){f.fulfill(d)},function(a){f.reject(a)}),f};return k.reduceRight=function(a,b,c){return m(a).then(function(a){return n(a,b,c)})},{State:c,Promise:g,Future:j,errors:{ValidationError:h,TimeoutError:i},collections:k}});